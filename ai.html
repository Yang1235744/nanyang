<!DOCTYPE html>
<html lang="zh-CN">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å—é˜³æ•°ç æ™ºèƒ½AI</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",sans-serif;}
html,body{height:100%;color:#fff;}
body{
  background:url(https://picsum.photos/id/1036/1920/1080) no-repeat center center fixed;
  background-size:cover;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.75);
  z-index:-1;
}

/* é¡¶éƒ¨å¯¼èˆªæ  ä¿ç•™åŸæ ·å¼ */
.topbar{
  position:fixed; top:0; left:0; width:100%; height:56px;
  background:rgba(20,26,40,0.9);
  display:flex; align-items:center;
  padding:0 20px; z-index:99;
}
.logo{font-size:18px; color:#38bdf8; font-weight:600;}
.menu{margin-left:auto; display:flex; gap:16px;}
.menu a{color:#c0c6d6; text-decoration:none; font-size:14px;}

/* èŠå¤©å®¹å™¨ ä¿ç•™åŸæ ·å¼ */
.chat-container{
  position:fixed; top:56px; left:0; width:100%;
  height:calc(100% - 124px);
  padding:15px; overflow-y:auto;
}

.welcome{
  background:rgba(30,37,50,0.9);
  padding:12px 16px; border-radius:12px;
  margin-bottom:15px; text-align:center;
}
.download-btn{
  display:inline-block; margin-top:8px;
  background:#38bdf8; color:#fff;
  padding:8px 16px; border-radius:8px;
  text-decoration:none; font-size:14px;
}

/* è¾“å…¥æ  ä¿ç•™åŸæ ·å¼ */
.input-bar{
  position:fixed; bottom:0; left:0; width:100%; height:68px;
  background:rgba(20,26,40,0.9);
  display:flex; align-items:center;
  padding:0 15px; gap:10px;
}
#input-text{
  flex:1; height:44px; border-radius:22px;
  border:none; background:rgba(30,37,50,0.9);
  color:#fff; padding:0 18px;
  font-size:15px; outline:none;
}
#send-btn{
  width:44px; height:44px; border-radius:50%;
  background:#38bdf8; color:#fff; border:none; cursor:pointer;
}
#camera-btn{
  display:none; width:44px; height:44px;
  border-radius:50%; background:#252d3a;
  color:#fff; border:none; font-size:18px; cursor:pointer;
}
#deepseek-btn{
  padding:8px 12px; border-radius:18px;
  background:#252d3a; color:#fff; border:none;
  font-size:13px; cursor:pointer;
}
#deepseek-btn.on{
  background:#38bdf8;
}

/* æ¶ˆæ¯æ ·å¼ ä¿ç•™åŸæ ·å¼ */
.msg{margin:14px 0; display:flex; align-items:flex-start; gap:8px;}
.msg.user{justify-content:flex-end;}
.avatar{
  width:36px; height:36px; border-radius:50%;
  background:url(https://picsum.photos/id/1036/200/200) center center / cover;
  flex-shrink:0;
}
.msg-bubble{
  max-width:70%; padding:10px 14px;
  border-radius:18px; line-height:1.5; font-size:15px;
  white-space: pre-wrap;
}
.msg.user .msg-bubble{
  background:#38bdf8; color:#fff; border-bottom-right-radius:6px;
}
.msg.ai .msg-bubble{
  background:rgba(30,37,50,0.9); color:#e6e6e6; border-bottom-left-radius:6px;
}

/* æ ¸å¿ƒï¼šWindowsé£æ ¼ å…¨å±ç»´æŠ¤å°é”å±‚ */
.maintain-mask{
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.85); /* æ·±è‰²é®ç½©ï¼Œç›–ä½æ‰€æœ‰å†…å®¹ */
  z-index:999; /* æœ€é«˜å±‚çº§ï¼Œå‹è¿‡æ‰€æœ‰å…ƒç´  */
  display:flex; align-items:center; justify-content:center;
}
/* Windowsè“æ¡†ç™½å­—æç¤ºæ¡† */
.maintain-box{
  border:2px solid #0078d4; /* ç»å…¸Windowsè“è¾¹ */
  background:#fff; /* ç™½æ¡† */
  padding:40px 50px;
  max-width:500px;
  width:90%;
  text-align:center;
}
.maintain-title{
  font-size:24px;
  color:#0078d4; /* è“è‰²æ ‡é¢˜ */
  font-weight:bold;
  margin-bottom:20px;
}
.maintain-text{
  font-size:18px;
  color:#333; /* é»‘è‰²æ­£æ–‡ */
  line-height:1.8;
}
/* åŠ è½½åŠ¨ç”» ä¿ç•™ï¼ˆå¤‡ç”¨ï¼‰ */
.loading{
  color:#999; font-size:14px;
  display:flex; align-items:center; gap:6px;
}
.loading span{
  display:inline-block; width:8px; height:8px;
  border-radius:50%; background:#38bdf8;
  animation: load 1s infinite alternate;
}
.loading span:nth-child(2){animation-delay:0.2s;}
.loading span:nth-child(3){animation-delay:0.4s;}
@keyframes load {from{opacity:0.3;transform:scale(0.8);}to{opacity:1;transform:scale(1);}}
</style>

<!-- é¡¶éƒ¨å¯¼èˆª ä¿ç•™åŸå†…å®¹ -->
<div class="topbar">
  <div class="logo">å—é˜³æ•°ç åˆ†èº«åŠ©æ‰‹ä¸ºæ‚¨æä¾›æœåŠ¡</div>
  <div class="menu">
    <a href="index.html">é¦–é¡µ</a>
    <a href="about.html">å…³äºæˆ‘ä»¬</a>
    <a href="ai.html">AIåŠ©æ‰‹</a>
  </div>
</div>

<!-- èŠå¤©å®¹å™¨ ä¿ç•™åŸå†…å®¹ -->
<div class="chat-container" id="chat-container">
  <div class="welcome">
    <div>ç³»ç»Ÿé•œåƒä¸‹è½½</div>
    <a href="https://www.123684.com/s/s9H3Td-PiQg" class="download-btn" target="_blank">ç‚¹å‡»è·å–é•œåƒ</a>
  </div>
</div>

<!-- è¾“å…¥æ  ä¿ç•™åŸå†…å®¹ -->
<div class="input-bar">
  <button id="deepseek-btn">æ·±åº¦æ€è€ƒ</button>
  <input id="input-text" placeholder="è¾“å…¥é—®é¢˜...">
  <button id="camera-btn">ğŸ“·</button>
  <button id="send-btn">â¤</button>
</div>

<!-- æ ¸å¿ƒï¼šWindowsé£æ ¼ å…¨å±ç»´æŠ¤å°é”æ¡† -->
<div class="maintain-mask">
  <div class="maintain-box">
    <div class="maintain-title">AIæœåŠ¡ç»´æŠ¤ä¸­</div>
    <div class="maintain-text">
      å—é˜³æ•°ç æ™ºèƒ½AIæ­£åœ¨å‡çº§ç»´æŠ¤<br>
      é¢„è®¡<span style="color:#0078d4; font-weight:bold;">24å°æ—¶å</span>æ¢å¤æ­£å¸¸ä½¿ç”¨<br>
      ç»™æ‚¨å¸¦æ¥ä¸ä¾¿ï¼Œæ•¬è¯·è°…è§£ï¼
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const chat = document.getElementById('chat-container');
  const input = document.getElementById('input-text');
  const send = document.getElementById('send-btn');
  const cameraBtn = document.getElementById('camera-btn');
  const deepseekBtn = document.getElementById('deepseek-btn');

  let deepseek = false;
  const SERVER_IP = 'http://192.168.1.78:5000';
  const isMobile = /Android|iPhone|iPad|iPod/.test(navigator.userAgent);
  if (isMobile) cameraBtn.style.display = 'block';

  // æ‰€æœ‰åŸåŠŸèƒ½ä¿ç•™ï¼ˆè§£å°æ—¶ç›´æ¥åˆ ç»´æŠ¤å±‚ä»£ç å³å¯ï¼‰
  function addMsg(text, isUser, isLoading = false){
    const div = document.createElement('div');
    div.className = isUser ? 'msg user' : 'msg ai';
    if(!isUser) div.innerHTML = '<div class="avatar"></div>';
    const bubble = document.createElement('div');
    bubble.className = isLoading ? 'loading' : 'msg-bubble';
    if(isLoading){
      bubble.innerHTML = '<span></span><span></span><span></span>æ­£åœ¨æ€è€ƒ...';
    }else{
      bubble.innerText = text;
    }
    div.appendChild(bubble);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return bubble;
  }

  async function getAIServerReply(text){
    try {
      const res = await fetch(`${SERVER_IP}/api/ai/reply`, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({question: text, deepseek: deepseek})
      });
      const data = await res.json();
      return data.reply || 'æœåŠ¡å™¨å·²æ”¶åˆ°é—®é¢˜ï¼Œæš‚æœªè¿”å›å›ç­”~';
    } catch (err) {
      return 'å—é˜³æ•°ç æ™ºèƒ½AIæ­£åœ¨ç»´æŠ¤å‡çº§ä¸­ï¼Œæš‚æ—¶æ— æ³•æä¾›æœåŠ¡ï¼Œè¯·ç¨åå†è¯•ã€‚';
    }
  }

  deepseekBtn.addEventListener('click', function(){
    deepseek = !deepseek;
    deepseekBtn.classList.toggle('on', deepseek);
    deepseekBtn.textContent = deepseek ? 'æ·±åº¦æ€è€ƒ ON' : 'æ·±åº¦æ€è€ƒ';
  });

  async function sendMsg(){
    const val = input.value.trim();
    if(!val) return;
    addMsg(val, true);
    input.value = '';
    const loadingBubble = addMsg('', false, true);
    const serverReply = await getAIServerReply(val);
    loadingBubble.className = 'msg-bubble';
    loadingBubble.innerText = serverReply;
    chat.scrollTop = chat.scrollHeight;
  }

  send.addEventListener('click', sendMsg);
  input.addEventListener('keypress', function(e){
    if(e.key === 'Enter') sendMsg();
  });

  cameraBtn.addEventListener('click', function(){
    const inp = document.createElement('input');
    inp.type = 'file';
    inp.accept = 'image/*';
    inp.onchange = () => {
      addMsg('[å·²å‘é€å›¾ç‰‡]', true);
      const loadingBubble = addMsg('', false, true);
      setTimeout(()=>{
        loadingBubble.className = 'msg-bubble';
        loadingBubble.innerText = 'å›¾ç‰‡å·²æ”¶åˆ°ï¼Œæˆ‘ä¼šå¸®ä½ åˆ†æã€‚';
      }, 600);
    };
    inp.click();
  });
});
</script>
</html>
