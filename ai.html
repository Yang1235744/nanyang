<!DOCTYPE html>
<html lang="zh-CN">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å—é˜³æ•°ç æ™ºèƒ½AI</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei",sans-serif;}
html,body{height:100%;color:#fff;}
body{
  background:url(https://picsum.photos/id/1036/1920/1080) no-repeat center center fixed;
  background-size:cover;
  position:relative;
}
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:rgba(0,0,0,0.75);
  z-index:-1;
}

.topbar{
  position:fixed; top:0; left:0; width:100%; height:56px;
  background:rgba(20,26,40,0.9);
  display:flex; align-items:center;
  padding:0 20px; z-index:99;
}
.logo{font-size:18px; color:#38bdf8; font-weight:600;}
.menu{margin-left:auto; display:flex; gap:16px;}
.menu a{color:#c0c6d6; text-decoration:none; font-size:14px;}

.chat-container{
  position:fixed; top:56px; left:0; width:100%;
  height:calc(100% - 124px);
  padding:15px; overflow-y:auto;
}

.welcome{
  background:rgba(30,37,50,0.9);
  padding:12px 16px; border-radius:12px;
  margin-bottom:15px; text-align:center;
}
.download-btn{
  display:inline-block; margin-top:8px;
  background:#38bdf8; color:#fff;
  padding:8px 16px; border-radius:8px;
  text-decoration:none; font-size:14px;
}

.input-bar{
  position:fixed; bottom:0; left:0; width:100%; height:68px;
  background:rgba(20,26,40,0.9);
  display:flex; align-items:center;
  padding:0 15px; gap:10px;
}
#input-text{
  flex:1; height:44px; border-radius:22px;
  border:none; background:rgba(30,37,50,0.9);
  color:#fff; padding:0 18px;
  font-size:15px; outline:none;
}
#send-btn{
  width:44px; height:44px; border-radius:50%;
  background:#38bdf8; color:#fff; border:none; cursor:pointer;
}
#camera-btn{
  display:none; width:44px; height:44px;
  border-radius:50%; background:#252d3a;
  color:#fff; border:none; font-size:18px; cursor:pointer;
}
#deepseek-btn{
  padding:8px 12px; border-radius:18px;
  background:#252d3a; color:#fff; border:none;
  font-size:13px; cursor:pointer;
}
#deepseek-btn.on{
  background:#38bdf8;
}

.msg{margin:14px 0; display:flex; align-items:flex-start; gap:8px;}
.msg.user{justify-content:flex-end;}
.avatar{
  width:36px; height:36px; border-radius:50%;
  background:url(https://picsum.photos/id/1036/200/200) center center / cover;
  flex-shrink:0;
}
.msg-bubble{
  max-width:70%; padding:10px 14px;
  border-radius:18px; line-height:1.5; font-size:15px;
  white-space: pre-wrap;
}
.msg.user .msg-bubble{
  background:#38bdf8; color:#fff; border-bottom-right-radius:6px;
}
.msg.ai .msg-bubble{
  background:rgba(30,37,50,0.9); color:#e6e6e6; border-bottom-left-radius:6px;
}
/* åŠ è½½çŠ¶æ€æ ·å¼ */
.loading{
  color:#999; font-size:14px;
  display:flex; align-items:center; gap:6px;
}
.loading span{
  display:inline-block; width:8px; height:8px;
  border-radius:50%; background:#38bdf8;
  animation: load 1s infinite alternate;
}
.loading span:nth-child(2){animation-delay:0.2s;}
.loading span:nth-child(3){animation-delay:0.4s;}
@keyframes load {from{opacity:0.3;transform:scale(0.8);}to{opacity:1;transform:scale(1);}}
</style>

<div class="topbar">
  <div class="logo">å—é˜³æ•°ç åˆ†èº«åŠ©æ‰‹ä¸ºæ‚¨æä¾›æœåŠ¡</div>
  <div class="menu">
    <a href="index.html">é¦–é¡µ</a>
    <a href="about.html">å…³äºæˆ‘ä»¬</a>
    <a href="ai.html">AIåŠ©æ‰‹</a>
  </div>
</div>

<div class="chat-container" id="chat-container">
  <div class="welcome">
    <div>ç³»ç»Ÿé•œåƒä¸‹è½½</div>
    <a href="https://www.123684.com/s/s9H3Td-PiQg" class="download-btn" target="_blank">ç‚¹å‡»è·å–é•œåƒ</a>
  </div>
</div>

<div class="input-bar">
  <button id="deepseek-btn">æ·±åº¦æ€è€ƒ</button>
  <input id="input-text" placeholder="è¾“å…¥é—®é¢˜...">
  <button id="camera-btn">ğŸ“·</button>
  <button id="send-btn">â¤</button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function(){
  const chat = document.getElementById('chat-container');
  const input = document.getElementById('input-text');
  const send = document.getElementById('send-btn');
  const cameraBtn = document.getElementById('camera-btn');
  const deepseekBtn = document.getElementById('deepseek-btn');

  let deepseek = false;
  // ä½ çš„LinuxæœåŠ¡å™¨åœ°å€ï¼ˆæ ¸å¿ƒä¿®æ”¹ï¼šå†…ç½‘IPï¼‰
  const SERVER_IP = 'http://192.168.1.78:5000';
  const isMobile = /Android|iPhone|iPad|iPod/.test(navigator.userAgent);
  if (isMobile) cameraBtn.style.display = 'block';

  // æ·»åŠ æ¶ˆæ¯ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼‰
  function addMsg(text, isUser, isLoading = false){
    const div = document.createElement('div');
    div.className = isUser ? 'msg user' : 'msg ai';
    if(!isUser) div.innerHTML = '<div class="avatar"></div>';
    const bubble = document.createElement('div');
    bubble.className = isLoading ? 'loading' : 'msg-bubble';
    if(isLoading){
      bubble.innerHTML = '<span></span><span></span><span></span>æ­£åœ¨æ€è€ƒ...';
    }else{
      bubble.innerText = text;
    }
    div.appendChild(bubble);
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return bubble;
  }

  // æ ¸å¿ƒä¿®æ”¹ï¼šåˆ é™¤æœ¬åœ°å‡æ•°æ®åº“ï¼Œæ›¿æ¢ä¸ºè¯·æ±‚æœåŠ¡å™¨æ¥å£
  async function getAIServerReply(text){
    try {
      // å‘ä½ çš„LinuxæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œæºå¸¦é—®é¢˜å’Œæ·±åº¦æ€è€ƒçŠ¶æ€
      const res = await fetch(`${SERVER_IP}/api/ai/reply`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          question: text,
          deepseek: deepseek
        })
      });
      const data = await res.json();
      // æœåŠ¡å™¨è¿”å›çš„å›å¤å†…å®¹
      return data.reply || 'æœåŠ¡å™¨å·²æ”¶åˆ°é—®é¢˜ï¼Œæš‚æœªè¿”å›å›ç­”~';
    } catch (err) {
      // è¿æ¥å¤±è´¥æç¤ºï¼ˆæ–¹ä¾¿ä½ æ’æŸ¥æœåŠ¡å™¨é—®é¢˜ï¼‰
      return `è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼\nè¯·æ£€æŸ¥ï¼š\n1. æœåŠ¡å™¨192.168.1.78æ˜¯å¦å¼€æœº\n2. 5000ç«¯å£æ˜¯å¦å¼€å¯\n3. å†…ç½‘ç©¿é€æ˜¯å¦é…ç½®`;
    }
  }

  // æ·±åº¦æ€è€ƒæŒ‰é’®ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼‰
  deepseekBtn.addEventListener('click', function(){
    deepseek = !deepseek;
    deepseekBtn.classList.toggle('on', deepseek);
    deepseekBtn.textContent = deepseek ? 'æ·±åº¦æ€è€ƒ ON' : 'æ·±åº¦æ€è€ƒ';
  });

  // å‘é€æ¶ˆæ¯ï¼ˆä¿®æ”¹ä¸ºè¯·æ±‚æœåŠ¡å™¨ï¼‰
  async function sendMsg(){
    const val = input.value.trim();
    if(!val) return;
    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
    addMsg(val, true);
    input.value = '';
    // æ·»åŠ åŠ è½½çŠ¶æ€
    const loadingBubble = addMsg('', false, true);
    // è¯·æ±‚æœåŠ¡å™¨è·å–çœŸå®å›å¤
    const serverReply = await getAIServerReply(val);
    // æ›¿æ¢åŠ è½½çŠ¶æ€ä¸ºçœŸå®å›å¤
    loadingBubble.className = 'msg-bubble';
    loadingBubble.innerText = serverReply;
    chat.scrollTop = chat.scrollHeight;
  }

  // å‘é€æŒ‰é’®+å›è½¦ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼‰
  send.addEventListener('click', sendMsg);
  input.addEventListener('keypress', function(e){
    if(e.key === 'Enter') sendMsg();
  });

  // ç›¸æœºæŒ‰é’®ï¼ˆä¿ç•™åŸåŠŸèƒ½ï¼Œå¯åç»­æ‰©å±•ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼‰
  cameraBtn.addEventListener('click', function(){
    const inp = document.createElement('input');
    inp.type = 'file';
    inp.accept = 'image/*';
    inp.onchange = () => {
      addMsg('[å·²å‘é€å›¾ç‰‡]', true);
      const loadingBubble = addMsg('', false, true);
      // åç»­å¯åŠ å›¾ç‰‡ä¸Šä¼ æœåŠ¡å™¨çš„ä»£ç ï¼Œè¿™é‡Œå…ˆä¿ç•™åŸæç¤º
      setTimeout(()=>{
        loadingBubble.className = 'msg-bubble';
        loadingBubble.innerText = 'å›¾ç‰‡å·²æ”¶åˆ°ï¼Œæˆ‘ä¼šå¸®ä½ åˆ†æã€‚';
      }, 600);
    };
    inp.click();
  });
});
</script>
</html>
